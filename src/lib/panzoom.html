<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0,">
    <title>Document</title>
</head>

<body>
    <div>
        Lorem ipsum dolor sit amet consectetur adipisicing elit. Accusamus dolorum aut voluptates ut neque
        exercitationem modi laudantium, dolor natus odio amet soluta delectus ipsa voluptatibus! Temporibus labore eos
        provident. Laboriosam error id nihil optio perferendis incidunt quibusdam magni doloribus odit voluptate tempore
        sit cupiditate sunt, dolorem molestias harum esse hic. Fugiat distinctio eaque, laudantium itaque molestiae
        aliquid! Porro consequuntur itaque vero reiciendis at non dolor incidunt recusandae libero veniam sed asperiores
        rerum debitis nesciunt ipsa maxime dicta, dignissimos veritatis voluptatibus quam quos aspernatur deserunt
        impedit. Odit autem cumque placeat, tenetur perspiciatis ab porro molestiae at odio exercitationem enim!
        Consequatur, pariatur.
    </div>
    <div class="lightbox">
        <img src="./../../static/images/pikachu.png" alt="">
    </div>
    <div>
        Lorem ipsum dolor sit amet consectetur adipisicing elit. Illum sit aut, doloremque odio dicta dolores tempora
        voluptates sequi ipsa dolorum accusamus hic ab officia quos placeat exercitationem repellendus quia? Repudiandae
        quisquam culpa excepturi perferendis dolor fugiat odit est sed nemo, architecto dicta ab tempore autem.
        Temporibus error magnam soluta architecto ad et minus tenetur suscipit earum qui ab eaque, at molestias.
        Accusantium, animi. Blanditiis asperiores consectetur ea veritatis enim, nobis sed ducimus deserunt. Quibusdam,
        labore. Inventore quis a consequuntur nisi esse, dolore sapiente natus. Ab quisquam voluptatibus deleniti alias
        a mollitia exercitationem reiciendis, amet doloremque ullam optio nemo eius iure itaque provident delectus
        fugiat id! Accusamus delectus reprehenderit quisquam iste laudantium iusto facilis voluptatum, tenetur suscipit
        quas beatae consectetur deserunt sint sit ut asperiores et eaque porro doloribus quam nesciunt recusandae!
        Tenetur iure asperiores nobis libero aut molestiae tempora id velit, voluptatibus, adipisci minima ipsum facilis
        sed at a quasi.
    </div>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            user-select: none;
            -webkit-user-select: none;
        }

        .lightbox {
            width: 200px;
            height: 200px;
            background: #0000003f;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        img {
            position: absolute;
            width: 100px;
            height: 100px;
            cursor: grab;
            transition: 200ms;
        }
    </style>

    <script>

        const img = document.querySelector('img');
        const lightbox = document.querySelector('.lightbox');

        class PanZoom {

            constructor(img) {
                this.img = img;
                // original position
                this.originalX = 0;
                this.originalY = 0;
                this.originalHeight = parseFloat(getComputedStyle(img).height); // getComputedStyle returns computed styles, which are better for calculating than style properties
                this.originalWidth = parseFloat(getComputedStyle(img).width); // Similarly for width
                this.self = this;
                this.increment = 0.1;
                // is dragging
                this.isDragging = false;
            }

            DragStart(e) {
                this.isDragging = true;
                this.originalX = e.offsetX;
                this.originalY = e.offsetY;
            }

            DragEnd() {
                this.isDragging = false;
            }

            Pan(e) {
                if (this.isDragging) {
                    const dx = e.offsetX - this.originalX;
                    const dy = e.offsetY - this.originalY;

                    this.img.style.left = `${dx}px`;
                    this.img.style.top = `${dy}px`;
                }
            }

            getTransformMatrix() {
                const style = this.img.style.transform;
                if (style === '') {
                    return {
                        scale: 1,
                        translateX: 0,
                        translateY: 0
                    };
                }
                const values = style.split(/\w+\(|\);?/);
                const transform = values[1].split(/,\s?/);
                return {
                    scale: parseFloat(transform[0]),
                    translateX: parseFloat(transform[1]),
                    translateY: parseFloat(transform[2])
                };
            }

            setTransformMatrix({ scale, translateX, translateY }) {
                this.img.style.transform = `scale(${scale}) translate(${translateX}px, ${translateY}px)`;
            }

            /**
             * 
             * @param {number} dx 
             * @param {number} dy 
             */
            applyTranslate(dx, dy) {
                const newTrans = this.getTransformMatrix();
                newTrans.translateX += dx;
                newTrans.translateY += dy;
                this.setTransformMatrix(newTrans);
            }

            /**
             * 
             * @param {number} dscale 
             * @param {number} x 
             * @param {number} y 
             */
            applyScale(dscale, x, y) {
                const newTrans = this.getTransformMatrix();
                const width = ele.width ? ele.width : ele.offsetWidth;
                const height = ele.height ? ele.height : ele.offsetHeight;
                const tranX = x - (width / 2);
                const tranY = y - (height / 2);
                dscale = (this.liner ? dscale : dscale * (newTrans.scale)); // scale either liner or non-liner 
                newTrans.scale += dscale;

                const maxOrMinScale = (newTrans.scale <= this.minScale || newTrans.scale >= this.maxScale);
                if (newTrans.scale < this.minScale)
                    newTrans.scale = this.minScale;
                if (newTrans.scale > this.maxScale)
                    newTrans.scale = this.maxScale;
                if (!maxOrMinScale) {
                    this.applyTranslate(tranX, tranY);
                    this.setTransformMatrix(newTrans);
                    this.applyTranslate(-(tranX * dscale), -(tranY * dscale));
                }
            }
            
            /**
             *
             * @param {WheelEvent} e
             */
            wheelListener(e) {
                if (e.deltaY < 0) {
                    this.applyScale(this.increment, e.offsetX, e.offsetY);
                }
                else {
                    this.applyScale(-this.increment, e.offsetX, e.offsetY);
                }
            }

            AttachListeners() {
                this.img.addEventListener('mousedown', this.DragStart);
                this.img.addEventListener('mouseup', this.DragEnd);
                this.img.addEventListener('mousemove', this.Pan);
                this.img.addEventListener('wheel', this.wheelListener);
            }

        }



        const panZoom = new PanZoom(img);
        panZoom.AttachListeners();


    </script>

</body>

</html>